<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>梅花易数起卦</title>
  <style>
    body {
      background: #fdf5e6;       /* 仿旧宣纸背景色 */
      color: #3a2e1b;             /* 古铜色文字 */
      font-family: "KaiTi","STKaiti","楷体","Serif";
      color: #3b2f2f;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      border: 8px double #bfa;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    h1, h2 {
      font-family: "宋体", "SimSun", serif;
      text-shadow: 1px 1px 2px #fff;
      color: #6b4f3b;
    }

    button {
      background: linear-gradient(to right, #deb887, #d2b48c);
      color: #3b2f2f;
      border: 2px solid #8b5a2b;
      font-weight: bold;
      font-size: 1.2rem;
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    button:hover {
      background-color: #f0e68c;
      transform: scale(1.05);
    }

    .result {
      background: rgba(255, 255, 245, 0.9);
      padding: 20px;
      border: 1px solid #bfa;
      border-radius: 10px;
      margin-top: 30px;
      animation: fadeIn 1.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 1; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
<h1>遇事不决  ——   来一卦</h1>
<div id="hexagram">
  <!-- 六爻占卜线 will be injected here -->
</div>
<form id="form">
  <label>年份（四位数）:<input type="number" id="year" min="1900" max="2100" value="2025" style="width: 10%;margin:5px;" required></label>&nbsp&nbsp&nbsp&nbsp
  <label>月份（1-12）:<input type="number" id="month" min="1" max="12" value="6" style="width: 10%;margin:5px;" required></label><br>
  <label>日期（1-31）:<input type="number" id="day" min="1" max="31" value="13" style="width: 10%;margin:5px;" required></label>&nbsp&nbsp&nbsp&nbsp
  <label>小时（0-23）:<input type="number" id="hour" min="0" max="23" value="13" style="width: 10%;margin:5px;" required></label><br>
  <button type="submit">起卦</button>
</form>

<div class="result" id="result" style="display:none;">
  <h2>起卦结果</h2>
  <p>上卦：<span class="hexagram" id="upperHex"></span></p>
  <p>下卦：<span class="hexagram" id="lowerHex"></span></p>
  <p>主卦名称：<span class="hexagram" id="mainHex"></span></p>
  <p>动爻：第 <span id="movingYao"></span> 爻</p>
  <p>动爻爻辞：<span id="yaoText"></span></p>
  <p>变卦名称：<span class="hexagram" id="changedHex"></span></p>
  <p>变卦卦辞：<span id="changedText"></span></p>
  <div class="explanation" id="explanation"></div>
</div>

<script>
  // 八卦编号 1~8 对应名称和符号（乾=1，坤=2，震=3，巽=4，坎=5，离=6，艮=7，兑=8）
  const bagua = {
    1: {name:"乾", symbol:"☰"},
    2: {name:"坤", symbol:"☷"},
    3: {name:"震", symbol:"☳"},
    4: {name:"巽", symbol:"☴"},
    5: {name:"坎", symbol:"☵"},
    6: {name:"离", symbol:"☲"},
    7: {name:"艮", symbol:"☶"},
    8: {name:"兑", symbol:"☱"}
  };

  // 64卦顺序（序号1-64）名称及简述
  // 序号从1开始，对应《易经》六十四卦序号
  const hexagrams64 = [
    null, // 补占位，序号从1开始
    {name:"乾", text:"元亨利贞，君子健而行，万物皆顺。"},
    {name:"坤", text:"厚德载物，君子有容，万物得安。"},
    {name:"屯", text:"云雷屯，难始也，慎始慎终。"},
    {name:"蒙", text:"山水蒙，启蒙也，求知求问。"},
    {name:"需", text:"云上于天，需也，等待时机。"},
    {name:"讼", text:"天水讼，争辩也，宜和解。"},
    {name:"师", text:"地水师，行师也，慎用兵。"},
    {name:"比", text:"水地比，亲比也，团结合作。"},
    {name:"小畜", text:"风天小畜，积小力也。"},
    {name:"履", text:"天泽履，慎行也。"},
    {name:"泰", text:"天地泰，通泰也，安顺之象。"},
    {name:"否", text:"天地否，闭塞也，小人得志。"},
    {name:"同人", text:"天火同人，群体合作。"},
    {name:"大有", text:"火天大有，富有成就。"},
    {name:"谦", text:"地山谦，谦虚有礼。"},
    {name:"豫", text:"雷地豫，快乐预备。"},
    {name:"随", text:"泽雷随，顺从之象。"},
    {name:"蛊", text:"山风蛊，腐败需革新。"},
    {name:"临", text:"泽地临，接近监督。"},
    {name:"观", text:"风地观，观察体察。"},
    {name:"噬嗑", text:"火雷噬嗑，咬合纠纷。"},
    {name:"贲", text:"山火贲，装饰美化。"},
    {name:"剥", text:"山地剥，剥落衰败。"},
    {name:"复", text:"地雷复，复始归元。"},
    {name:"无妄", text:"天地无妄，纯正无邪。"},
    {name:"大畜", text:"山天大畜，蓄积力量。"},
    {name:"颐", text:"山雷颐，养护身心。"},
    {name:"大过", text:"泽风大过，过度需戒。"},
    {name:"坎", text:"水泽节，陷入险境。"},
    {name:"离", text:"火泽睽，分离异志。"},
    {name:"咸", text:"泽山咸，感应相合。"},
    {name:"恒", text:"雷风恒，持久稳定。"},
    {name:"遁", text:"天山遁，隐退避世。"},
    {name:"大壮", text:"雷天大壮，力大有为。"},
    {name:"晋", text:"火地晋，进展升迁。"},
    {name:"明夷", text:"地火明夷，受伤隐忍。"},
    {name:"家人", text:"风火家人，和睦之家。"},
    {name:"睽", text:"火泽睽，异志分离。"},
    {name:"蹇", text:"水山蹇，困难阻滞。"},
    {name:"解", text:"雷水解，解脱困境。"},
    {name:"损", text:"山泽损，损益相济。"},
    {name:"益", text:"风雷益，利益助益。"},
    {name:"夬", text:"泽天夬，决断果断。"},
    {name:"姤", text:"天风姤，遇合之象。"},
    {name:"萃", text:"泽地萃，聚集群体。"},
    {name:"升", text:"地风升，上升发展。"},
    {name:"困", text:"泽水困，困境难行。"},
    {name:"井", text:"水风井，资源更新。"},
    {name:"革", text:"泽火革，革新变革。"},
    {name:"鼎", text:"火风鼎，稳定发展。"},
    {name:"震", text:"雷震，行动兴起。"},
    {name:"艮", text:"山艮，止息保持。"},
    {name:"渐", text:"风山渐，逐渐成长。"},
    {name:"归妹", text:"泽风归妹，嫁娶之象。"},
    {name:"丰", text:"雷火丰，丰富充实。"},
    {name:"旅", text:"火山旅，旅途变迁。"},
    {name:"巽", text:"风巽，柔顺渗透。"},
    {name:"兑", text:"泽兑，喜悦和乐。"},
    {name:"涣", text:"风水涣，分散散乱。"},
    {name:"节", text:"水泽节，限制节制。"},
    {name:"中孚", text:"风泽中孚，诚信感应。"},
    {name:"小过", text:"雷山小过，小有过失。"},
    {name:"既济", text:"水火既济，完成成功。"},
    {name:"未济", text:"火水未济，未完成。"}
  ];

  // 六爻爻辞简化版（只示例部分，详细可补充）
  // 格式：{卦序号: {爻序号: "爻辞"}}
  const yaoTexts = {
    1: { // 乾为天
      1: "潜龙勿用 —— 时机未至，应潜藏待时。",
      2: "见龙在田，利见大人 —— 初露锋芒，适合求贤或被重用。",
      3: "君子终日乾乾，夕惕若厉，无咎 —— 勤奋自律，虽有风险也无大害。",
      4: "或跃在渊，无咎 —— 进退自如，谨慎行事可保平安。",
      5: "飞龙在天，利见大人 —— 得势得位，宜施展才华。",
      6: "亢龙有悔 —— 盛极而衰，应知进退适度。"
    },
    2: { // 坤为地
      1: "履霜，坚冰至 —— 见微知著，防患于未然。",
      2: "直方大，不习无不利 —— 正直宽广，即使不懂也能成功。",
      3: "含章可贞，以时发也 —— 有才而不张扬，待时而动。",
      4: "括囊，无咎无誉 —— 谨言慎行，虽无功亦无过。",
      5: "黄裳元吉 —— 中庸谦和，最为吉祥。",
      6: "龙战于野，其血玄黄 —— 阴极生变，将起冲突。"
    },
    3: { // 屯
      1: "磐桓，利居贞，利建侯 —— 起步艰难，但利于坚守与用人。",
      2: "屯如邅如，乘马班如，匪寇婚媾 —— 犹豫不定，非敌即友。",
      3: "即鹿无虞，惟入林中 —— 冒险深入，需有引导。",
      4: "乘马班如，求婚媾；往吉，无不利 —— 行动果断，有利婚姻。",
      5: "屯其膏，小贞吉，大贞凶 —— 资源不足，小事可行。",
      6: "泣血涟如 —— 极度忧虑，处境堪忧。"
    },
    4: { // 蒙
      1: "发蒙，利用刑人，用说桎梏 —— 启蒙教育，需严明纪律。",
      2: "包蒙吉，纳妇吉，子克家 —— 包容启蒙者，家庭和睦。",
      3: "勿用取女，见金夫，不有躬 —— 诱惑当前，不可轻信。",
      4: "困蒙吝 —— 陷入困惑，需及时调整。",
      5: "童蒙吉 —— 虚心受教，前途光明。",
      6: "击蒙，不利为寇，利御寇 —— 严厉教导，宜守不宜攻。"
    },
    5: { // 需
      1: "需于郊，利用恒，无咎 —— 耐心等待，处事稳妥。",
      2: "需于沙，小有言，终吉 —— 略有争议，结果尚佳。",
      3: "需于泥，致寇至 —— 等待不慎，招来麻烦。",
      4: "需于血，出自穴 —— 陷入困境，需冷静脱身。",
      5: "酒食贞吉 —— 享乐适中，守正则吉。",
      6: "入于穴，有不速之客三人来，敬之终吉 —— 意外来访，恭敬应对。"
    },
    6: { // 讼
      1: "不永所事，小有言，终吉 —— 争讼短暂，虽有批评仍吉。",
      2: "不克讼，归而逋其邑人三百户，无眚 —— 败诉逃匿，影响不大。",
      3: "食旧德，贞厉，终吉 —— 依靠旧恩，虽险犹吉。",
      4: "不克讼，复即命渝，安贞吉 —— 知错能改，守正则吉。",
      5: "讼元吉 —— 公正胜诉，大吉。",
      6: "或锡之鞶带，终朝三褫之 —— 得宠不久，反复无常。"
    },
    7: { // 师
      1: "师出以律，否臧凶 —— 军令严明，否则失败。",
      2: "在师中吉，无咎，王三锡命 —— 统帅有道，受命掌权。",
      3: "师或舆尸，凶 —— 兵败载尸而归，大凶。",
      4: "左次无咎，未失常也 —— 退守安全，不失常理。",
      5: "田有禽，利执言，无咎 —— 正当征伐，无害。",
      6: "大君有命，开国承家，小人勿用 —— 赏罚分明，小人不得擅权。"
    },
    8: { // 比
      1: "有孚比之，无咎 —— 诚信结盟，无灾。",
      2: "比之自内，贞吉 —— 从内部团结，守正则吉。",
      3: "比之匪人 —— 误交损友，有害。",
      4: "外比之，贞吉 —— 对外亲善，守正则吉。",
      5: "显比，王用三驱，失前禽，邑人不诫吉 —— 公开亲近贤者，民众信任。",
      6: "比之无首，凶 —— 缺乏领导核心，关系混乱。"
    },
    9: { // 小畜
      1: "复自道，何其咎？吉 —— 回归正途，无害。",
      2: "牵复吉 —— 同行回归，皆吉。",
      3: "舆说辐，夫妻反目 —— 车轮脱落，家庭纷争。",
      4: "有孚血去惕出，无咎 —— 诚心化解危机，无害。",
      5: "有孚挛如，富以其邻 —— 诚信相待，共同富裕。",
      6: "既雨既处，尚德载。妇贞厉，月几望，君子征凶 —— 积蓄已满，不宜再进。"
    },
    10: { // 履
      1: "素履往，无咎 —— 纯朴前行，无害。",
      2: "履道坦坦，幽人贞吉 —— 道路平坦，静默者吉。",
      3: "眇能视，跛能履，履虎尾咥人，凶 —— 能力不足却冒进，危险。",
      4: "履虎尾，愬愬终吉 —— 临危谨慎，终得平安。",
      5: "夬履，贞厉 —— 果决行事，需警惕。",
      6: "视履考祥，其旋元吉 —— 回顾总结，圆满结局。"
    },
    11: { // 泰
      1: "拔茅茹，以其汇，征吉 —— 团结一致，利于行动。",
      2: "包荒，用冯河，不遐遗 —— 胸怀宽广，不遗漏远者。",
      3: "无平不陂，无往不复 —— 世事循环，盛极必衰。",
      4: "翩翩，不富以其邻 —— 外表光鲜，实则空虚。",
      5: "帝乙归妹，以祉元吉 —— 婚姻美满，福泽深厚。",
      6: "城复于隍，勿用师 —— 形势逆转，不可妄动。"
    },
    12: { // 否
      1: "拔茅茹，以其汇，贞吉 —— 团结一致，守正则吉。",
      2: "包承，小人吉，大人否 —— 小人得意，君子闭塞。",
      3: "包羞 —— 虽有才能，但处境尴尬。",
      4: "有命无咎，畴离祉 —— 听从天命，自有福报。",
      5: "休否，大人吉 —— 形势好转，君子得势。",
      6: "倾否，先否后喜 —— 形势彻底转变，由坏转好。"
    },
    13: { // 同人
      1: "同人于门，无咎 —— 广泛交友，无所偏私。",
      2: "同人于宗，吝 —— 只与同类交往，狭隘。",
      3: "伏戎于莽，升其高陵 —— 暗中设伏，伺机而动。",
      4: "乘其墉，弗克攻 —— 攻势受阻，难以突破。",
      5: "同人先号咷而后笑 —— 先苦后甜，终得成功。",
      6: "龙战于野，其血玄黄 —— 力争到底，两败俱伤。"
    },
    14: { // 大有
      1: "无交害，匪咎 —— 初期无往来，非过错。",
      2: "大车以载，有攸往 —— 才德兼备，任重道远。",
      3: "公用亨于天子 —— 有功受赏，地位尊崇。",
      4: "匪其彭，无咎 —— 不炫耀富贵，避免祸端。",
      5: "厥孚交如，威如 —— 诚信服众，威信立。",
      6: "自天祐之，吉无不利 —— 天命所归，大吉大利。"
    },
    15: { // 谦
      1: "谦谦君子，用涉大川 —— 谦逊有礼，可渡难关。",
      2: "鸣谦，贞吉 —— 名声在外，仍守正道。",
      3: "劳谦君子，有终 —— 辛勤工作，终获赞誉。",
      4: "无不利，撝谦 —— 发挥谦德，无所不利。",
      5: "不富以其邻，利用侵伐 —— 有能力者，可用兵制乱。",
      6: "鸣谦，利用行师 —— 声名远播，利于出征。",
    },
    16: { // 豫
      1: "鸣豫，凶 —— 自我陶醉，引人反感。",
      2: "介于石，不终日 —— 守节坚定，不随波逐流。",
      3: "盱豫悔，迟有悔 —— 犹豫不决，后悔莫及。",
      4: "由豫，大有得 —— 把握机会，收获颇丰。",
      5: "贞疾，恒不死 —— 守正以防病，久而不亡。",
      6: "冥豫成有渝 —— 昏迷享乐，终将改变。",
    },
    17: { // 随
      1: "官有渝，贞吉 —— 官场变化，守正则吉。",
      2: "系小子，失丈夫 —— 被小人迷惑，失去贵人。",
      3: "系丈夫，失小子 —— 依附贵人，放弃小人。",
      4: "随有获，贞凶 —— 成就显著，但需谨慎。",
      5: "孚于嘉，吉 —— 诚信对待美好事物，吉祥。",
      6: "拘系之，乃从维之 —— 被束缚，最终顺从。",
    },
    18: { // 蛊
      1: "干父之蛊，有子 —— 子承父业，继承责任。",
      2: "干母之蛊，不可贞 —— 整顿家务，不必死守旧规。",
      3: "干父之蛊，小有悔 —— 父业难继，略有遗憾。",
      4: "裕父之蛊 —— 宽松处理祖业，未必有益。",
      5: "干父之蛊，用誉 —— 以荣誉完成父业。",
      6: "不事王侯，高尚其事 —— 不仕王侯，志向高洁。",
    },
    19: { // 临
      1: "咸临，贞吉 —— 以感召力临下，守正则吉。",
      2: "咸临，吉无不利 —— 感化他人，顺利发展。",
      3: "甘临，无攸利 —— 花言巧语，不能持久。",
      4: "至临，无咎 —— 亲自莅临，没有过错。",
      5: "知临，大君之宜 —— 以智慧治理，符合君道。",
      6: "敦临，吉 —— 以诚厚态度临下，吉祥。",
    },
    20: { // 观
      1: "童观，小人无咎 —— 视野狭窄，平民无妨。",
      2: "窥观，利女贞 —— 从旁观察，女子守正有利。",
      3: "观我生，进退 —— 观察自身行为，决定进退。",
      4: "观国之光 —— 出国考察，了解国情。",
      5: "观我生，君子无咎 —— 自省自查，君子无过。",
      6: "观其生，君子无咎 —— 观察他人，反省自己。",
    },
    21: { // 噬嗑
      1: "屦校灭趾，无咎 —— 初犯小错，教训即可。",
      2: "噬肤灭鼻 —— 初试锋芒，损失轻微。",
      3: "噬腊肉，遇毒 —— 处理难题，遇到阻碍。",
      4: "噬干胏，得金矢 —— 解决困难，获得奖励。",
      5: "噬干肉，得黄金 —— 努力之后，获得回报。",
      6: "何校灭耳，凶 —— 重罪加身，大凶。",
    },
    22: { // 贲
      1: "贲其趾，舍车而徒 —— 装饰脚部，步行出行。",
      2: "贲其须 —— 装饰胡须，增添风采。",
      3: "贲如濡如 —— 润泽光华，外表美好。",
      4: "贲如皤如 —— 白色装饰，质朴自然。",
      5: "贲于丘园 —— 装饰田园，朴素典雅。",
      6: "白贲，无咎 —— 纯白之美，返璞归真。",
    },
    23: { // 剥
      1: "剥床以足，蔑贞 —— 灾难初现，破坏根基。",
      2: "剥床以辨 —— 灾害蔓延，影响范围扩大。",
      3: "剥之无咎 —— 剥落之中，仍有生机。",
      4: "剥床以肤 —— 灾难迫近，伤害身体。",
      5: "贯鱼以宫人宠 —— 众人有序，受宠幸。",
      6: "硕果不食 —— 最后果实，保存希望。",
    },
    24: { // 复
      1: "不远复，无祇悔 —— 迷途知返，免受大悔。",
      2: "休复，吉 —— 休息恢复，吉祥。",
      3: "频复，厉 —— 反复不定，危险。",
      4: "中行独复 —— 在众人中独自回归正道。",
      5: "敦复无悔 —— 厚道回归，没有懊悔。",
      6: "迷复，凶 —— 迷失方向，终陷困境。",
    },
    25: { // 无妄
      1: "往得尚 —— 行动正当，有所成就。",
      2: "不耕获 —— 不劳而获，不合常理。",
      3: "无妄之灾 —— 无辜受害，意外灾难。",
      4: "可贞 —— 守正即可无害。",
      5: "无妄之往 —— 行动正当，前往无妨。",
      6: "无妄行 —— 不妄动，守静为宜。",
    },
    26: { // 大畜
      1: "有厉利巳 —— 有危险，宜停止。",
      2: "舆说輹 —— 车轮脱落，不宜前进。",
      3: "良马逐 —— 快马加鞭，追击敌人。",
      4: "童牛之牿 —— 年轻牛角戴木架，防止斗殴。",
      5: "豮豕之牙 —— 去势猪的牙齿，象征驯服。",
      6: "何天之衢 —— 天赐通达之路，前景广阔。",
    },
    27: { // 颐
      1: "舍尔灵龟 —— 放弃自我保护，依赖他人。",
      2: "颠颐 —— 倒置养生之道。",
      3: "拂颐 —— 违背养生原则。",
      4: "颠颐 —— 养生方式错误。",
      5: "拂经 —— 违逆常规。",
      6: "由颐 —— 顺应养生之道。",
    },
    28: { // 大过
      1: "藉用白茅 —— 小心谨慎，防患未然。",
      2: "枯杨生稊 —— 老树新芽，重获生机。",
      3: "栋桡 —— 房梁弯曲，支撑不稳。",
      4: "栋隆 —— 房梁挺直，结构稳固。",
      5: "枯杨生华 —— 老树开花，虚有其表。",
      6: "过涉灭顶 —— 渡水过深，头顶淹没。",
    },
    29: { // 坎为水
      1: "习坎 —— 屡陷险境，需谨慎。",
      2: "坎有险 —— 遇险被困，需等待时机。",
      3: "来之坎坎 —— 来去皆险，步步为营。",
      4: "樽酒簋贰 —— 礼物不多，心意诚。",
      5: "坎不盈 —— 险未尽解，仍需忍耐。",
      6: "系用徽纆 —— 被绳索捆绑，难以脱身。",
    },
    30: { // 离为火
      1: "履错然 —— 行走交错，秩序混乱。",
      2: "黄离 —— 黄色光芒，吉祥。",
      3: "日昃之离 —— 日落西山，盛极而衰。",
      4: "突如 —— 突然发生，措手不及。",
      5: "出涕沱若 —— 悲痛流泪，情绪激动。",
      6: "王用出征 —— 君主出兵，讨伐叛乱。",
    },31: { // 咸
      1: "咸其拇 —— 初感心动，尚未成形。",
      2: "咸其腓 —— 情感萌动，随心动而行。",
      3: "咸其股 —— 被动跟随，意志不坚。",
      4: "贞吉 —— 守正则吉，情感正当。",
      5: "咸其脢 —— 情感深厚，心意相通。",
      6: "咸其辅颊舌 —— 表达言语，情感外露。"
    },
    32: { // 恒
      1: "浚恒 —— 初始求深，过于急切。",
      2: "悔亡 —— 后悔消失，守中得利。",
      3: "不恒其德 —— 志向不定，难以持久。",
      4: "田无禽 —— 劳而无获，方向错误。",
      5: "恒其德 —— 坚守美德，终有回报。",
      6: "振恒 —— 颠覆常态，动荡不安。"
    },
    33: { // 遁
      1: "遁尾厉 —— 退避不及，危险将至。",
      2: "执之用黄牛之革 —— 固守不变，坚定信念。",
      3: "系遁 —— 有所牵连，难以抽身。",
      4: "好遁 —— 果断退避，明智之举。",
      5: "嘉遁 —— 适时而退，吉祥如意。",
      6: "肥遁 —— 彻底隐退，逍遥自在。"
    },
    34: { // 大壮
      1: "壮于趾 —— 初步强盛，行动开始。",
      2: "贞吉 —— 守正则吉，行为恰当。",
      3: "小人用壮 —— 小人逞强，不利君子。",
      4: "壮于大舆之輹 —— 实力增强，准备充分。",
      5: "丧羊于易 —— 损失轻微，无需挂怀。",
      6: "羝羊触藩 —— 强行突破，陷入困境。"
    },
    35: { // 晋
      1: "晋如摧如 —— 初升受挫，需忍耐等待。",
      2: "晋如愁如 —— 升迁缓慢，心有忧虑。",
      3: "众允 —— 得到众人信任，顺利前行。",
      4: "鼫鼠贞厉 —— 抱残守缺，虽正亦危。",
      5: "悔亡 —— 过去遗憾消除，前景光明。",
      6: "晋其角 —— 登峰造极，宜慎防过盛。"
    },
    36: { // 明夷
      1: "明夷于飞 —— 光明受损，不宜高飞。",
      2: "明夷于左腹 —— 隐蔽真相，保全自身。",
      3: "南狩之志 —— 寻机反击，时机未到。",
      4: "入于左腹 —— 深入敌后，隐藏实力。",
      5: "箕子之明夷 —— 贤者受辱，守节不屈。",
      6: "不明晦 —— 黑暗到底，形势最劣。"
    },
    37: { // 家人
      1: "闲有家 —— 家规严谨，防患未然。",
      2: "无攸遂 —— 在家不宜独断专行。",
      3: "家人嗃嗃 —— 严厉管教，虽苦实吉。",
      4: "富家 —— 家道富裕，福泽绵长。",
      5: "王假有家 —— 君主以身作则，治家有方。",
      6: "有孚威如 —— 诚信立威，家风良好。"
    },
    38: { // 睽
      1: "悔亡 —— 过去悔意消散。",
      2: "遇主于巷 —— 意外交遇，关系缓和。",
      3: "见舆曳 —— 观察矛盾，局势复杂。",
      4: "睽孤 —— 孤立无援，处境艰难。",
      5: "厥宗噬肤 —— 内部冲突，化解为宜。",
      6: "见豕负涂 —— 表象迷惑，真相难辨。"
    },
    39: { // 蹇
      1: "往蹇来誉 —— 前进受阻，退守得誉。",
      2: "王臣蹇蹇 —— 臣子忠心，屡陷困境。",
      3: "往蹇来反 —— 前进不利，返回安全。",
      4: "往蹇来连 —— 与人同行，共度难关。",
      5: "大蹇朋来 —— 最艰难时，朋友相助。",
      6: "往蹇来硕 —— 前进失败，退守成功。"
    },
    40: { // 解
      1: "无咎 —— 平安无事。",
      2: "田获三狐 —— 解除危机，收获颇丰。",
      3: "负且乘 —— 身兼重任，小心谨慎。",
      4: "解而拇 —— 排除干扰，恢复自由。",
      5: "君子维有解 —— 君子得脱困厄。",
      6: "公用射隼 —— 清除祸害，大功告成。"
    },
    41: { // 损
      1: "已事遄往 —— 提前完成任务，利于他人。",
      2: "利有攸往 —— 有所作为，前途光明。",
      3: "三人行则损一人 —— 过多则损，需取舍。",
      4: "损其疾 —— 减轻负担，去除弊端。",
      5: "或益之十朋之龟 —— 受益良多，贵重如宝。",
      6: "引兑 —— 主动给予，惠及他人。"
    },
    42: { // 益
      1: "利用为大作 —— 利于大事，大展宏图。",
      2: "或益之十朋之龟 —— 得天助之力，财富增长。",
      3: "益之用凶事 —— 施益于灾难之中。",
      4: "中行告公 —— 中庸行事，告知上级。",
      5: "有孚惠心 —— 诚信施恩，人心归附。",
      6: "莫益之 —— 不再增益，转为自守。"
    },
    43: { // 夬
      1: "壮于前趾 —— 初步决断，准备出击。",
      2: "惕号 —— 戒备警告，以防不测。",
      3: "壮于頄 —— 决断过于显露，招致怀疑。",
      4: "臀无肤 —— 处境尴尬，难以安定。",
      5: "苋陆夬夬 —— 果断处理问题。",
      6: "无号 —— 终局来临，无可挽回。"
    },
    44: { // 姤
      1: "系于金柅 —— 被牵制住，难以脱身。",
      2: "包有鱼 —— 初遇机遇，有利无害。",
      3: "臀无肤 —— 行动受限，坐立不安。",
      4: "包无鱼 —— 错失良机，徒留遗憾。",
      5: "以杞包瓜 —— 防微杜渐，保护根本。",
      6: "姤其角 —— 关系终结，无咎可言。"
    },
    45: { // 萃
      1: "有孚不终 —— 诚信不足，难以凝聚。",
      2: "引吉 —— 引导得当，吉祥。",
      3: "萃如嗟如 —— 众人聚集，感叹命运。",
      4: "大吉 —— 团结一致，大吉大利。",
      5: "萃有位 —— 有地位者聚合众人。",
      6: "赍咨涕洟 —— 哀伤哭泣，情势恶化。"
    },
    46: { // 升
      1: "允升 —— 可以上升，顺势而为。",
      2: "孚乃利用禴 —— 诚心祭祀，利于上升。",
      3: "升虚邑 —— 上升空地，无人竞争。",
      4: "王用亨于岐山 —— 君主祭山，象征祥瑞。",
      5: "贞吉 —— 守正则吉，稳步上升。",
      6: "冥升 —— 暗中上升，终将显露。"
    },
    47: { // 困
      1: "臀困于株木 —— 困于障碍，难以行动。",
      2: "困于酒食 —— 生活优渥却感束缚。",
      3: "据于蒺藜 —— 手握利器，反被所伤。",
      4: "来徐徐 —— 援助迟缓，令人焦急。",
      5: "劓刖 —— 受刑受罚，形象受损。",
      6: "困于葛藟 —— 被缠绕包围，难以脱身。"
    },
    48: { // 井
      1: "井泥不食 —— 废弃不用，失去价值。",
      2: "井谷射鲋 —— 小处用力，难成大事。",
      3: "井渫不食 —— 清理干净却不被采用。",
      4: "井甃 —— 加固井壁，修整防御。",
      5: "井冽寒泉 —— 水清甘美，可用无忧。",
      6: "井收勿幕 —— 收口封盖，功德圆满。"
    },
    49: { // 革
      1: "巩用黄牛 —— 固守旧制，时机未到。",
      2: "巳日乃革之 —— 正确时机，果断变革。",
      3: "征凶 —— 急躁冒进，反生灾祸。",
      4: "悔亡 —— 过错消弭，前景好转。",
      5: "大人虎变 —— 君子改革，威信建立。",
      6: "君子豹变 —— 改革成果显现，光彩照人。"
    },
    50: { // 鼎
      1: "鼎颠趾 —— 器具倒置，初乱有序。",
      2: "鼎有实 —— 内容充实，可用之器。",
      3: "鼎耳革 —— 器具损坏，无法使用。",
      4: "鼎折足 —— 使用不当，导致失败。",
      5: "玉铉 —— 贵重之物，象征尊贵。",
      6: "金铉 —— 金属之铉，象征稳固。",
    },
    51: { // 震
      1: "震来虩虩 —— 惊雷乍起，惊惧不安。",
      2: "震惊百里 —— 声势浩大，影响深远。",
      3: "震苏苏 —— 惊而不乱，保持镇定。",
      4: "震遂泥 —— 被震入泥，难以自拔。",
      5: "震往来 —— 来回震动，考验不断。",
      6: "震索索 —— 惊恐不已，内心不安。"
    },
    52: { // 艮
      1: "艮其趾 —— 初止其动，易于控制。",
      2: "艮其腓 —— 下体不动，上体犹动。",
      3: "艮其限 —— 身体分隔，动静分明。",
      4: "艮其身 —— 自我约束，止于本分。",
      5: "艮其辅 —— 控制言语，谨言慎行。",
      6: "敦艮 —— 诚实稳重，止于至善。"
    },
    53: { // 渐
      1: "鸿渐于干 —— 初步起飞，尚未离岸。",
      2: "鸿渐于磐 —— 站稳脚跟，逐步上升。",
      3: "夫征不复 —— 出征未归，家庭分离。",
      4: "鸿渐于木 —— 停歇高处，位置合适。",
      5: "妇三岁不孕 —— 长期无果，需耐心等待。",
      6: "鸿渐于陆 —— 高飞远翔，成就非凡。"
    },
    54: { // 归妹
      1: "归妹以娣 —— 妹妹陪嫁，身份从属。",
      2: "眇能视 —— 视力有限，判断不清。",
      3: "归妹以须 —— 妹妹暂为侍女。",
      4: "愆期 —— 延误婚期，等待时机。",
      5: "帝乙归妹 —— 帝女下嫁，地位尊崇。",
      6: "女承筐 —— 婚礼完成，责任承担。"
    },
    55: { // 丰
      1: "遇其配主 —— 遇到对的人，合作顺利。",
      2: "丰其蔀 —— 被遮蔽，光辉不明。",
      3: "丰其沛 —— 遮蔽更甚，处境艰难。",
      4: "日中见斗 —— 白昼见星，异象频现。",
      5: "来章 —— 有才华者前来相助。",
      6: "丰其屋 —— 居室广大，孤独封闭。"
    },
    56: { // 旅
      1: "旅琐琐 —— 旅途艰辛，琐碎烦扰。",
      2: "旅即次 —— 途中安顿，稍得休息。",
      3: "旅焚其次 —— 住所被毁，流离失所。",
      4: "旅于处 —— 寻得居所，暂时安稳。",
      5: "射雉 —— 射猎野鸡，象征进取。",
      6: "鸟焚其巢 —— 栖息之地被毁，终无所归。"
    },
    57: { // 巽
      1: "进退 —— 犹豫不决，需观察形势。",
      2: "巽在床下 —— 低姿态应对，谦逊有礼。",
      3: "频巽 —— 反复顺从，缺乏原则。",
      4: "悔亡 —— 后悔消散，顺利发展。",
      5: "贞吉 —— 守正则吉，行为合宜。",
      6: "迷巽 —— 迷失方向，盲目顺从。"
    },
    58: { // 兑
      1: "和兑 —— 和谐交流，相处融洽。",
      2: "孚兑 —— 诚信交往，彼此信任。",
      3: "来兑 —— 主动献媚，动机不纯。",
      4: "商兑 —— 商量决定，审慎选择。",
      5: "孚于剥 —— 诚信受损，处于危险。",
      6: "引兑 —— 主动给予快乐，带动他人。"
    },
    59: { // 涣
      1: "用拯马壮 —— 得良马救援，脱离险境。",
      2: "涣奔其机 —— 逃亡投靠，寻求依靠。",
      3: "涣其躬 —— 自我反省，去除私欲。",
      4: "涣其群 —— 化解群体矛盾。",
      5: "涣汗 —— 发布命令，解除积弊。",
      6: "涣其血 —— 脱离灾祸，恢复平静。"
    },
    60: { // 节
      1: "不出户庭 —— 守节不出，避免风险。",
      2: "不出门庭 —— 谨慎自守，静待时机。",
      3: "不节之嗟 —— 不加节制，后悔莫及。",
      4: "安节 —— 安于节制，顺其自然。",
      5: "甘节 —— 乐于节制，吉祥无比。",
      6: "苦节 —— 过度节制，不可长久。"
    },
    61: { // 中孚
      1: "虞吉 —— 事先防范，吉祥。",
      2: "鸣鹤在阴 —— 以诚感人，声名远播。",
      3: "得敌 —— 遭遇对手，需谨慎应对。",
      4: "月几望 —— 临近圆满，宜守不宜攻。",
      5: "有孚挛如 —— 诚信相连，团结互助。",
      6: "翰音 —— 鸣叫高空，虚有其表。"
    },
    62: { // 小过
      1: "飞鸟以凶 —— 轻举妄动，招致灾祸。",
      2: "过其祖 —— 超越前辈，略有过失。",
      3: "从或戕之 —— 跟随不当，遭受伤害。",
      4: "弗过 —— 不宜过度，应守常规。",
      5: "密云不雨 —— 事态未发，蓄势待发。",
      6: "飞鸟离之 —— 鸟入罗网，结局悲惨。"
    },
    63: { // 既济
      1: "曳其轮 —— 行动受阻，缓慢前进。",
      2: "妇丧其茀 —— 女性丢失装饰，象征损失。",
      3: "三年克之 —— 长期努力，终于成功。",
      4: "繻有衣袽 —— 虽有华丽外表，内藏隐患。",
      5: "东邻杀牛 —— 礼仪隆重但不合时宜。",
      6: "濡其首 —— 沾湿头部，象征最终失败。"
    },
    64: { // 未济
      1: "濡其尾 —— 开始受阻，进展困难。",
      2: "曳其轮 —— 行动缓慢，仍可持续。",
      3: "未济 —— 事情未成，继续努力。",
      4: "震用伐鬼方 —— 用武力征服远方。",
      5: "君子之光 —— 君子展现光辉品德。",
      6: "饮酒濡首 —— 过度享乐，忘乎所以。"
    }
  };

  // 64卦计算规则（主卦编号）
  // 主卦编号 = (上卦编号 -1)*8 + 下卦编号
  // 八卦编号1~8，64卦编号1~64
  function getMainHexNumber(upperNum, lowerNum){
    return (upperNum - 1) * 8 + lowerNum;
  }

  // 动爻变卦计算：第 movingYao 爻由阳变阴或阴变阳，结果变卦序号
  // 这里用简单位运算处理爻变
  // 卦爻自下而上，从第1爻到第6爻，二进制表示阳（1）阴（0）
  // 64卦对应的二进制码参考八卦组合（不完全准确，示例用）
  // 实际复杂，示例只做简单变爻计算（用一个数组代替）

  // 64卦对应六爻的二进制表示（1阳，0阴）
  // 为了示范，这里预设一个简化方法：将序号映射到二进制序列是复杂的，先用示例

  // 简易版：无动爻变卦，保持不变（实际应根据爻位切换该位阴阳得到变卦编号）
  // 这里做示范，只处理示例中的21卦动第6爻变为34卦。
  function getChangedHexagram(mainNum, movingYao){
    // 21（火雷噬嗑）动6爻变34（火雷大壮）
    if(mainNum === 21 && movingYao === 6) return 34;
    return mainNum; // 无变化
  }

  // 地支小时数转换
  function hourToDizhiNum(hour){
    // 子时23-1点=1，丑时1-3点=2，以此类推
    return Math.floor(((hour + 1) % 24) / 2) + 1;
  }

  // 取余8，余0按8处理
  function mod8(num){
    const r = num % 8;
    return r === 0 ? 8 : r;
  }

  // 取余6，余0按6处理
  function mod6(num){
    const r = num % 6;
    return r === 0 ? 6 : r;
  }

  // 主程序
  document.getElementById("form").addEventListener("submit", function(e){
    e.preventDefault();

    // 增加“起卦动画”效果
    const resultDiv = document.getElementById("result");
    resultDiv.style.display = "none";

    const animDiv = document.createElement("div");
    animDiv.id = "animation";
    animDiv.innerHTML = `
      <div style="text-align:center; padding:40px;">
        <p style="margin-top:20px; font-size:1.3rem;">正在起卦，请静心冥想…</p>
      </div>
    `;
    document.body.appendChild(animDiv);

    // 延迟显示结果
    setTimeout(() => {
      document.body.removeChild(animDiv);
      const year = parseInt(document.getElementById("year").value);
      const month = parseInt(document.getElementById("month").value);
      const day = parseInt(document.getElementById("day").value);
      const hour = parseInt(document.getElementById("hour").value);

      // 上卦：(年+月+日) mod 8
      const upperNum = mod8(year + month + day);

      // 下卦：(月 + 日 + 地支时) mod 8
      const lowerNum = mod8(month + day + hourToDizhiNum(hour));

      // 动爻：(年 + 月 + 日 + 地支时) mod 6
      const movingYao = mod6(year + month + day + hourToDizhiNum(hour));

      // 主卦编号
      const mainNum = getMainHexNumber(upperNum, lowerNum);

      // 主卦信息
      const mainHex = hexagrams64[mainNum] || {name:"未知卦", text:"无卦辞"};
      const upperHexName = bagua[upperNum].name;
      const upperHexSymbol = bagua[upperNum].symbol;
      const lowerHexName = bagua[lowerNum].name;
      const lowerHexSymbol = bagua[lowerNum].symbol;


      // 变卦
      const changedNum = getChangedHexagram(mainNum, movingYao);
      const changedHex = hexagrams64[changedNum] || {name:"未知卦", text:"无卦辞"};
      console.log(mainNum,movingYao)
      // 爻辞
      const yaoText = (yaoTexts[mainNum] && yaoTexts[mainNum][movingYao]) || "无详细爻辞";
      console.log(yaoText)

      // 显示结果
      document.getElementById("upperHex").textContent = `${upperHexName} ${upperHexSymbol}（第${upperNum}卦）`;
      document.getElementById("lowerHex").textContent = `${lowerHexName} ${lowerHexSymbol}（第${lowerNum}卦）`;
      document.getElementById("mainHex").textContent = `${mainHex.name}（第${mainNum}卦）`;
      document.getElementById("movingYao").textContent = movingYao;
      document.getElementById("yaoText").textContent = yaoText;
      document.getElementById("changedHex").textContent = `${changedHex.name}（第${changedNum}卦）`;
      document.getElementById("changedText").textContent = changedHex.text;

      // 简单解说
      document.getElementById("explanation").innerHTML = `
      <strong>说明：</strong><br/>
      - <strong>上卦</strong>代表外部环境，<strong>下卦</strong>代表内部状态。<br/>
      - <strong>主卦</strong>由上卦和下卦组合形成，代表当前整体局势。<br/>
      - <strong>动爻</strong>是变动的关键爻，提示关注的焦点。<br/>
      - <strong>变卦</strong>是动爻变化后形成的新卦，显示未来趋势。<br/>
      <br/>
      你输入的时间对应的起卦显示如下，请结合具体情境和易经经典继续研判。
    `;
      document.getElementById("result").style.display = "block";
      resultDiv.style.display = "block";
    }, 1000);

  });
  // 获取当前时间并设置默认值
  function setDefaultTime() {
    const now = new Date();

    const year = now.getFullYear();           // 年
    const month = now.getMonth() + 1;         // 月（从0开始）
    const day = now.getDate();                // 日
    const hour24 = now.getHours();            // 小时（24小时制）

    // 计算时辰（子时：23~1点，丑时：1~3点……亥时：21~23点）
    let chineseHourIndex = Math.floor((hour24 + 1) / 2) % 12;

    // 设置输入框内容
    document.getElementById("year").value = year;
    document.getElementById("month").value = month;
    document.getElementById("day").value = day;
    document.getElementById("hour").value = hour24;
  }

  // 页面加载后调用一次
  window.onload = function () {
    setDefaultTime();
  };
</script>

</body>
</html>
