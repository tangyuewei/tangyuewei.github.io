<style>
  body {
    color: #333;
    background-color: #eee;
  }
  @media (prefers-color-scheme: dark) {
    body {
      background: black;
      color: white;
    }
  }
</style>
<div>
  <body>
  <div align="center">
    <h2>ChatGPT</h2>
    <div>注意：接口返回可能比较慢（服务在国外，并且ChatGPT返回速度也比较慢），提交后需要等待处理完成，请勿重复提交！！！</div>
    <div>~接口返回有长度限制~</div>
    <hr />
    <!--  {% if message %} {{ message }} {% endif %}-->
    <form method="post" onsubmit="submit.disabled=true">
      <textarea style="width:35%;" name="question" placeholder="点击这里输入问题" rows="11" id="form"></textarea>
      <br>
      <input type="submit" style="width:150px;height:50px;background-color:green;font-size:30px" value="提交" id="submit" />
    </form>
    <div id="loading" style="display:none; color:red"><b>后端正在处理，请稍等...</b></div>
    <!--  {% if question %}-->
    <div style="text-align: left"><b>人类:</b>
      <pre id="question">{{ question }}</pre>
    </div>
    <hr />
    <div style="text-align: left"><b>Chat GPT:</b>
      <pre style="text-align:left; white-space: pre-wrap;" id="res">{{ res }}</pre>
    </div>
    <!--  {% endif %}-->
  </div>
  </body>
</div>
<script src="https://unpkg.com/jquery@3.4.1/dist/jquery.js"></script>
<script>
  let loading = document.getElementById('loading');
  let form = document.querySelector('form');
  form.addEventListener('submit', () => {
    loading.style.display = 'block';
    let questionStr = document.getElementsByName('question');
    $.ajax(
      {
        url:'https://api.openai.com/v1/completions',
        type:'post',
        dateType:'json',
        beforeSend: function(xhr) {
          xhr.setRequestHeader('Authorization', 'Bearer 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');

        },
        headers:{'Content-Type':'application/json;charset=utf8','organId':'1333333333'},
        // data:JSON.stringify(org),
        data:'{"model": "text-davinci-003", "prompt": ' + questionStr + ' "temperature": 0, "max_tokens": 7}',
        success:function(data){
          console.log("sucess");
          console.log("data", data);
        },
        error:function(data){console.log("error");}
      }
    );

  });
</script>
