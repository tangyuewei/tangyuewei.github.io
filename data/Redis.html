<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | 唐悦玮</title>
    <meta name="description" content="努力只是一种生活方式，先敬业，再乐业">
    
    <meta name="keywords" content="缓存雪崩,缓存击穿,Redis简介,Redis使用场景,Redis使用指南,Redis数据类型">
    <link rel="preload" href="/assets/css/0.styles.49a09e5d.css" as="style"><link rel="preload" href="/assets/js/app.08b72cac.js" as="script"><link rel="preload" href="/assets/js/24.ea2cf265.js" as="script"><link rel="prefetch" href="/assets/js/10.14803a23.js"><link rel="prefetch" href="/assets/js/11.4289b726.js"><link rel="prefetch" href="/assets/js/12.1f16ca00.js"><link rel="prefetch" href="/assets/js/13.562ef4f8.js"><link rel="prefetch" href="/assets/js/14.d7919d60.js"><link rel="prefetch" href="/assets/js/15.18554717.js"><link rel="prefetch" href="/assets/js/16.a7a42460.js"><link rel="prefetch" href="/assets/js/17.b65c334c.js"><link rel="prefetch" href="/assets/js/18.8af4cec2.js"><link rel="prefetch" href="/assets/js/19.60feb48e.js"><link rel="prefetch" href="/assets/js/2.4d58626d.js"><link rel="prefetch" href="/assets/js/20.d4ec8f67.js"><link rel="prefetch" href="/assets/js/21.42a22e72.js"><link rel="prefetch" href="/assets/js/22.8a4f4238.js"><link rel="prefetch" href="/assets/js/23.eb3d97e8.js"><link rel="prefetch" href="/assets/js/25.d7c8740a.js"><link rel="prefetch" href="/assets/js/26.cd62a9e5.js"><link rel="prefetch" href="/assets/js/27.0ac4949f.js"><link rel="prefetch" href="/assets/js/28.2ba2c0c4.js"><link rel="prefetch" href="/assets/js/29.4db4d20d.js"><link rel="prefetch" href="/assets/js/3.4761a21f.js"><link rel="prefetch" href="/assets/js/30.2d01528b.js"><link rel="prefetch" href="/assets/js/31.ec6114b2.js"><link rel="prefetch" href="/assets/js/32.3aa908ad.js"><link rel="prefetch" href="/assets/js/33.d19f8cfb.js"><link rel="prefetch" href="/assets/js/34.3cf937ca.js"><link rel="prefetch" href="/assets/js/35.d7917a11.js"><link rel="prefetch" href="/assets/js/36.620f4839.js"><link rel="prefetch" href="/assets/js/37.8c5d0801.js"><link rel="prefetch" href="/assets/js/38.c8ff2500.js"><link rel="prefetch" href="/assets/js/39.f899679e.js"><link rel="prefetch" href="/assets/js/4.4a046784.js"><link rel="prefetch" href="/assets/js/40.7489618f.js"><link rel="prefetch" href="/assets/js/41.5011af83.js"><link rel="prefetch" href="/assets/js/42.003e4c8a.js"><link rel="prefetch" href="/assets/js/43.e088b09c.js"><link rel="prefetch" href="/assets/js/44.0aecb040.js"><link rel="prefetch" href="/assets/js/45.5a55e548.js"><link rel="prefetch" href="/assets/js/46.64e35459.js"><link rel="prefetch" href="/assets/js/47.0fbbb3cd.js"><link rel="prefetch" href="/assets/js/48.c11df92f.js"><link rel="prefetch" href="/assets/js/49.ef580b58.js"><link rel="prefetch" href="/assets/js/5.905b9bca.js"><link rel="prefetch" href="/assets/js/50.b12a5475.js"><link rel="prefetch" href="/assets/js/51.8451b540.js"><link rel="prefetch" href="/assets/js/52.673a8761.js"><link rel="prefetch" href="/assets/js/53.5434dd90.js"><link rel="prefetch" href="/assets/js/54.4dc8e18e.js"><link rel="prefetch" href="/assets/js/55.9a347483.js"><link rel="prefetch" href="/assets/js/56.892a6ef0.js"><link rel="prefetch" href="/assets/js/57.a5230ba7.js"><link rel="prefetch" href="/assets/js/58.939cd696.js"><link rel="prefetch" href="/assets/js/59.a60202e4.js"><link rel="prefetch" href="/assets/js/6.64b8df3d.js"><link rel="prefetch" href="/assets/js/60.7fcbfaa3.js"><link rel="prefetch" href="/assets/js/61.102cd029.js"><link rel="prefetch" href="/assets/js/62.efcc02f7.js"><link rel="prefetch" href="/assets/js/63.2159b871.js"><link rel="prefetch" href="/assets/js/64.ac9b2006.js"><link rel="prefetch" href="/assets/js/65.cdd61f79.js"><link rel="prefetch" href="/assets/js/66.edfb6058.js"><link rel="prefetch" href="/assets/js/67.75cecf46.js"><link rel="prefetch" href="/assets/js/68.3fb157a5.js"><link rel="prefetch" href="/assets/js/69.e690cdf0.js"><link rel="prefetch" href="/assets/js/7.d70360ae.js"><link rel="prefetch" href="/assets/js/70.9911e034.js"><link rel="prefetch" href="/assets/js/71.65ac58bd.js"><link rel="prefetch" href="/assets/js/72.b9453883.js"><link rel="prefetch" href="/assets/js/73.1590277e.js"><link rel="prefetch" href="/assets/js/74.f6d3cf45.js"><link rel="prefetch" href="/assets/js/75.596e6050.js"><link rel="prefetch" href="/assets/js/76.9847489d.js"><link rel="prefetch" href="/assets/js/77.e60a770f.js"><link rel="prefetch" href="/assets/js/78.211b6c06.js"><link rel="prefetch" href="/assets/js/79.f406f05c.js"><link rel="prefetch" href="/assets/js/8.db366737.js"><link rel="prefetch" href="/assets/js/80.41ef285e.js"><link rel="prefetch" href="/assets/js/81.dd3cd041.js"><link rel="prefetch" href="/assets/js/82.c053d0dd.js"><link rel="prefetch" href="/assets/js/83.6ea003e8.js"><link rel="prefetch" href="/assets/js/84.e09299d3.js"><link rel="prefetch" href="/assets/js/85.3287376f.js"><link rel="prefetch" href="/assets/js/86.193163d8.js"><link rel="prefetch" href="/assets/js/87.05fc0d76.js"><link rel="prefetch" href="/assets/js/88.5651f92c.js"><link rel="prefetch" href="/assets/js/89.6664a12c.js"><link rel="prefetch" href="/assets/js/9.93b8af4c.js"><link rel="prefetch" href="/assets/js/90.4f374e6e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.49a09e5d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">唐悦玮</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technical/" class="nav-link">技术博客</a></div><div class="nav-item"><a href="/article/" class="nav-link">管理思维</a></div><div class="nav-item"><a href="/micro_service/" class="nav-link">微服务架构</a></div><div class="nav-item"><a href="http://blog.tangyuewei.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客系统
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technical/" class="nav-link">技术博客</a></div><div class="nav-item"><a href="/article/" class="nav-link">管理思维</a></div><div class="nav-item"><a href="/micro_service/" class="nav-link">微服务架构</a></div><div class="nav-item"><a href="http://blog.tangyuewei.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客系统
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Java编程</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Spring Boot</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>软件工程</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>数据</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/data/MySql.html" class="sidebar-link">mysql</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data/MySql.html#下载安装" class="sidebar-link">下载安装</a></li><li class="sidebar-sub-header"><a href="/data/MySql.html#创建和使用数据库" class="sidebar-link">创建和使用数据库</a></li><li class="sidebar-sub-header"><a href="/data/MySql.html#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/data/MySql.html#字段操作" class="sidebar-link">字段操作</a></li><li class="sidebar-sub-header"><a href="/data/MySql.html#优化" class="sidebar-link">优化</a></li><li class="sidebar-sub-header"><a href="/data/MySql.html#缓存清理" class="sidebar-link">缓存清理</a></li></ul></li><li><a href="/data/MongoDB.html" class="sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data/MongoDB.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/data/MongoDB.html#特点" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/data/MongoDB.html#mongodb-crud操作" class="sidebar-link">MongoDB CRUD操作</a></li><li class="sidebar-sub-header"><a href="/data/MongoDB.html#聚合" class="sidebar-link">聚合</a></li><li class="sidebar-sub-header"><a href="/data/MongoDB.html#索引" class="sidebar-link">索引</a></li></ul></li><li><a href="/data/Redis.html" aria-current="page" class="active sidebar-link">Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data/Redis.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/data/Redis.html#数据类型" class="sidebar-link">数据类型</a></li><li class="sidebar-sub-header"><a href="/data/Redis.html#持久化" class="sidebar-link">持久化</a></li><li class="sidebar-sub-header"><a href="/data/Redis.html#集群方案" class="sidebar-link">集群方案</a></li><li class="sidebar-sub-header"><a href="/data/Redis.html#缓存雪崩" class="sidebar-link">缓存雪崩</a></li><li class="sidebar-sub-header"><a href="/data/Redis.html#缓存穿透" class="sidebar-link">缓存穿透</a></li><li class="sidebar-sub-header"><a href="/data/Redis.html#缓存与数据库双写时的数据不一致性" class="sidebar-link">缓存与数据库双写时的数据不一致性</a></li></ul></li><li><a href="/data/MemCached.html" class="sidebar-link">MemCached</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data/MemCached.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/data/MemCached.html#特点" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/data/MemCached.html#memcached-存储命令" class="sidebar-link">Memcached 存储命令</a></li><li class="sidebar-sub-header"><a href="/data/MemCached.html#memcached-查找命令" class="sidebar-link">Memcached 查找命令</a></li><li class="sidebar-sub-header"><a href="/data/MemCached.html#memcached-统计命令" class="sidebar-link">Memcached 统计命令</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>算法与数据结构</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>分布式系统</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p><a href="http://try.redis.io/" target="_blank" rel="noopener noreferrer">在线redis命令测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</p></blockquote> <h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <h3 id="字符串（strings）"><a href="#字符串（strings）" class="header-anchor">#</a> 字符串（strings）</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">set</span> mykey somevalue
OK
<span class="token operator">&gt;</span> get mykey
<span class="token string">&quot;somevalue&quot;</span>
</code></pre></div><ul><li>当key存在时SET会失败，当key不存在时它只会成功。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">set</span> mykey newval nx
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre></div><ul><li>当key不存在时会失败，当key存在时它会成功并更新值。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">set</span> mykey newval xx
OK
</code></pre></div><ul><li>原子递增：返回递增后的值</li></ul> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>key不存在会创建key，如果key存在，但不是integer类型则会报错
即使多个客户端对同一个key发出INCR命令，也决不会导致竞争的情况。</p></div> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">set</span> counter <span class="token number">100</span>
OK
<span class="token operator">&gt;</span> incr counter
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">101</span>
<span class="token operator">&gt;</span> incr counter
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">102</span>
<span class="token operator">&gt;</span> incrby counter <span class="token number">50</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">152</span>
</code></pre></div><ul><li>原子递减：返回递减后的值</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> decr counter
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">151</span>
<span class="token operator">&gt;</span> decrby counter <span class="token number">50</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">101</span>
</code></pre></div><ul><li>GETSET命令，行如其名：他为key设置新值并且返回原值。时间复杂度：O(1)</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code>redis<span class="token operator">&gt;</span> INCR mycounter
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
redis<span class="token operator">&gt;</span> GETSET mycounter <span class="token string">&quot;0&quot;</span>
<span class="token string">&quot;1&quot;</span>
redis<span class="token operator">&gt;</span> GET mycounter
<span class="token string">&quot;0&quot;</span>
redis<span class="token operator">&gt;</span> 
</code></pre></div><ul><li>一次存储或获取多个key对应的值</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> mset a <span class="token number">10</span> b <span class="token number">20</span> c <span class="token number">30</span>
OK
<span class="token operator">&gt;</span> mget a b c
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;10&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;20&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;30&quot;</span>
</code></pre></div><ul><li>TYPE命令可以返回key对应的值的存储类型,使用EXISTS命令返回1或0标识给定key的值是否存在</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">set</span> mykey x
OK
<span class="token operator">&gt;</span> <span class="token keyword">type</span> mykey
string
<span class="token operator">&gt;</span> del mykey
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token keyword">type</span> mykey
none
<span class="token operator">&gt;</span> <span class="token keyword">exists</span> mykey
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">0</span>

</code></pre></div><ul><li>Redis超时:数据在限定时间内存活,TTL命令用来查看key对应的值剩余存活时间。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">key</span> somevalue
OK
<span class="token operator">&gt;</span> expire <span class="token keyword">key</span> <span class="token number">5</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">1</span>

<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">key</span> <span class="token number">100</span> ex <span class="token number">10</span>
OK
<span class="token operator">&gt;</span> ttl <span class="token keyword">key</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">9</span>

</code></pre></div><h3 id="散列（hashes）"><a href="#散列（hashes）" class="header-anchor">#</a> 散列（hashes）</h3> <p>Hash 便于表示 objects, HMSET 指令设置 hash 中的多个域，而 HGET 取回单个域。HMGET 和 HGET 类似，返回多列值</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> hmset <span class="token keyword">user</span>:<span class="token number">1000</span> username tyw birthyear <span class="token number">2020</span> verified <span class="token number">1</span>
OK
<span class="token operator">&gt;</span> hget <span class="token keyword">user</span>:<span class="token number">1000</span> username
<span class="token string">&quot;tyw&quot;</span>
<span class="token operator">&gt;</span> hget <span class="token keyword">user</span>:<span class="token number">1000</span> birthyear
<span class="token string">&quot;2020&quot;</span>
<span class="token operator">&gt;</span> hgetall <span class="token keyword">user</span>:<span class="token number">1000</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;username&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;tyw&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;birthyear&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;2020&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;verified&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>

<span class="token operator">&gt;</span> hmget <span class="token keyword">user</span>:<span class="token number">1000</span> username birthyear <span class="token keyword">no</span><span class="token operator">-</span>such<span class="token operator">-</span>field
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;tyw&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;2020&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span>

</code></pre></div><ul><li>HINCRBY</li></ul> <blockquote><p>小的 hash 被用特殊方式编码，非常节约内存</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> hincrby <span class="token keyword">user</span>:<span class="token number">1000</span> birthyear <span class="token number">10</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">2030</span>
<span class="token operator">&gt;</span> hdecrby <span class="token keyword">user</span>:<span class="token number">1000</span> birthyear <span class="token number">10</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">2020</span>
</code></pre></div><h3 id="列表（lists）"><a href="#列表（lists）" class="header-anchor">#</a> 列表（lists）</h3> <ul><li><code>rpush mylist A</code> 右边插入,或者<code>rpush mylist A B C 1 'dd'</code></li> <li><code>lpush mylist first</code> 左边插入</li> <li><code>lrange mylist 0 -1</code> 列出元素</li> <li><code>rpop mylist</code> 右边删除元素，返回删除的值，左边删除<code>lpop mylist</code></li></ul> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>-1表示最后一个元素，-2表示list中的倒数第二个元素，以此类推。</p> <blockquote><p>应用场景： 1.聊天系统2.不同进程间传递消息的队列
例如在评级系统中，比如社会化新闻网站 reddit.com，你可以把每个新提交的链接添加到一个list，用LRANGE可简单的对结果分页。
在博客引擎实现中，你可为每篇日志设置一个list，在该list中推入博客评论，等等。</p></blockquote></div> <h3 id="集合（sets）"><a href="#集合（sets）" class="header-anchor">#</a> 集合（sets）</h3> <blockquote><p>Redis Set 是 String 的无序排列。SADD 指令把新的元素添加到 set 中。对 set 也可做一些其他的操作，比如测试一个给定的元素是否存在，对不同 set 取交集，并集或差，等等。</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> sadd myset <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
<span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token operator">&gt;</span> smembers myset
<span class="token number">1.</span> <span class="token number">3</span>
<span class="token number">2.</span> <span class="token number">1</span>
<span class="token number">3.</span> <span class="token number">2</span>
</code></pre></div><ul><li><p>Redis 有检测成员的指令
<code>sismember myset 3</code></p></li> <li><p>Sets 适合用于表示对象间的关系。假设我们想要给新闻打上标签
<code>sadd news:1000:tags 1 2 5 66</code></p></li> <li><p>SINTER 命令获取不同 set 的交集
<code>sinter tag:1:news tag:2:news tag:10:news tag:27:news</code></p></li> <li><p>返回集合中的所有成员
<code>smembers key</code></p></li> <li><p>获取集合的成员数
<code>scard key</code></p></li> <li><p>返回给定所有集合的差集
<code>sdiff key1 key2</code></p></li> <li><p>返回给定所有集合的差集并存储在 dest 中
<code>sdiffstore dest key1 key2</code></p></li> <li><p>返回给定所有集合的交集
<code>sinter key1 key2</code></p></li> <li><p>返回给定所有集合的交集并存储在 dest 中
<code>sinterstore dest key1 key2</code></p></li> <li><p>将 member 元素从 source 集合移动到 dest 集合
<code>smove source dest member</code></p></li> <li><p>移除并返回集合中的一个随机元素
<code>spop key</code></p></li> <li><p>返回集合中一个或多个随机数
<code>srandmember key count</code></p></li> <li><p>移除集合中一个或多个成员
<code>srem key member1 member2</code></p></li> <li><p>返回所有给定集合的并集
<code>sunion key1 key2</code></p></li> <li><p>所有给定集合的并集存储在 dest 集合中
<code>sunionstore dest key1 key2</code></p></li> <li><p>迭代集合中的元素
<code>sscan key cursor [match pattern] [count count]</code></p></li></ul> <h3 id="有序集合（sorted-sets）"><a href="#有序集合（sorted-sets）" class="header-anchor">#</a> 有序集合（sorted sets）</h3> <blockquote><p>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。 集合中最大的成员数为 2的32次方 -1 (4294967295,40多亿个)</p></blockquote> <ul><li><p>向有序集合添加一个或多个成员，或者更新已存在成员的分数
<code>zadd key score1 member1 score2 member2</code></p></li> <li><p>获取有序集合的成员数
<code>zcard key</code></p></li> <li><p>计算在有序集合中指定区间分数的成员数
<code>zcount key min max</code></p></li> <li><p>有序集合中对指定成员的分数加上增量 increment
<code>zincrby key increment member</code></p></li> <li><p>计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中
<code>zinterstore destination numkeys key key1 ...</code></p></li> <li><p>返回有序集中，成员的分数值
<code>zscore key member</code></p></li> <li><p>返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序
<code>zrevrank key member</code></p></li></ul> <h2 id="持久化"><a href="#持久化" class="header-anchor">#</a> 持久化</h2> <blockquote><p>持久化就是把内存的数据写到磁盘中去，防止服务宕机了内存数据丢失。</p></blockquote> <h3 id="rdb"><a href="#rdb" class="header-anchor">#</a> RDB</h3> <blockquote><p>RDB：Redis DataBase缩写,是Redis默认的持久化方式。按照一定的时间将内存的数据以快照的形式保存到硬盘中，
对应产生的数据文件为dump.rdb。通过配置文件中的save参数来定义快照的周期。</p></blockquote> <p>优点：</p> <ul><li>只有一个文件 dump.rdb，方便持久化。</li> <li>容灾性好，一个文件可以保存到安全的磁盘。</li> <li>性能最大化，fork 子进程来完成写操作，让主进程继续处理命令，所以是 IO 最大化，保证了 redis 的高性能。</li> <li>相对于数据集大时，启动效率比 AOF 的更高。
缺点：数据安全性较低，适合数据要求不是很严谨的情况下使用</li></ul> <h3 id="aof"><a href="#aof" class="header-anchor">#</a> AOF</h3> <blockquote><p>AOF即Append Only File持久化，则是将Redis执行的每次写命令记录到单独的日志文件中，当重启Redis会重新将持久化的日志中文件恢复数据。</p></blockquote> <p>当两种方式同时开启时，数据恢复Redis会优先选择AOF恢复。</p> <p>优点：</p> <ul><li>数据安全，aof 持久化可以配置 appendfsync 属性，有 always，每进行一次 命令操作就记录到 aof 文件中一次。</li> <li>通过 append 模式写文件，即使中途服务器宕机，可以通过 redis-check-aof 工具解决数据一致性问题。</li> <li>AOF 机制的 rewrite 模式。AOF 文件没被 rewrite 之前（文件过大时会对命令 进行合并重写），可以删除其中的某些命令（比如误操作的 flushall）
缺点：</li> <li>AOF 文件比 RDB 文件大，且恢复速度慢</li> <li>数据集大的时候，启动效率比 rdb 低</li></ul> <h2 id="集群方案"><a href="#集群方案" class="header-anchor">#</a> 集群方案</h2> <h3 id="哨兵模式"><a href="#哨兵模式" class="header-anchor">#</a> 哨兵模式</h3> <blockquote><p>sentinel用于实现 redis 集群的高可用，本身也是分布式的，作为一个哨兵集群去运行，互相协同工作。</p></blockquote> <p>核心：</p> <ul><li>哨兵至少需要 3 个实例。</li> <li>哨兵 + redis 主从的部署架构，是不保证数据零丢失的，只能保证 redis 集群的高可用性。</li></ul> <h3 id="官方-redis-cluster-方案-推荐"><a href="#官方-redis-cluster-方案-推荐" class="header-anchor">#</a> 官方 Redis Cluster 方案(推荐)</h3> <blockquote><p>Redis Cluster采用slot(槽)的概念，一共分成16384个槽。将请求发送到任意节点，接收到请求的节点会将查询请求发送到正确的节点上执行</p></blockquote> <p>优点：</p> <ul><li>无中心架构，支持动态扩容，对业务透明</li> <li>具备Sentinel的监控和自动Failover(故障转移)能力</li> <li>客户端不需要连接集群所有节点，连接集群中任何一个可用节点即可</li> <li>高性能，客户端直连redis服务，省去了proxy代理的损耗
缺点：</li> <li>运维很复杂，数据迁移需要人工干预</li> <li>只能使用0号数据库</li> <li>不支持批量操作(pipeline管道操作)</li> <li>分布式逻辑和存储模块耦合等</li></ul> <h2 id="缓存雪崩"><a href="#缓存雪崩" class="header-anchor">#</a> 缓存雪崩</h2> <ul><li>缓存数据的过期时间设置随机，防止同一时间大量数据过期现象发生。</li> <li>一般并发量不是特别多的时候，使用最多的解决方案是加锁排队。</li> <li>给每一个缓存数据增加相应的缓存标记，记录缓存的是否失效，如果缓存标记失效，则更新数据缓存。</li></ul> <h2 id="缓存穿透"><a href="#缓存穿透" class="header-anchor">#</a> 缓存穿透</h2> <ul><li>设置热点数据永远不过期。</li> <li>加互斥锁</li></ul> <h2 id="缓存与数据库双写时的数据不一致性"><a href="#缓存与数据库双写时的数据不一致性" class="header-anchor">#</a> 缓存与数据库双写时的数据不一致性</h2> <blockquote><p>先更新数据库，然后再删除缓存</p></blockquote></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2020/3/12 下午3:44:09</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/data/MongoDB.html" class="prev">
          MongoDB
        </a></span> <span class="next"><a href="/data/MemCached.html">
          MemCached
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.08b72cac.js" defer></script><script src="/assets/js/24.ea2cf265.js" defer></script>
  </body>
</html>
